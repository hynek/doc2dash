[gh-actions]
python =
    3.8: py38, docs
    3.9: py39
    3.10: py310,mypy


[tox]
envlist = pre-commit,mypy,py38,py39,py310,manifest,docs,pypi-description,coverage-report
isolated_build = true


[testenv:pre-commit]
skip_install = true
deps = pre-commit
commands = pre-commit run --all-files --show-diff-on-failure

[testenv:mypy]
extras = typing
commands = mypy docs/update-rtd-versions.py

[testenv]
passenv = LC_ALL
extras = tests
commands =
    coverage run --parallel -m pytest {posargs}
    coverage run --parallel -m doc2dash --version


[testenv:pypi-description]
basepython = python3.8
skip_install = true
deps =
    twine
    pip >= 18.0.0
commands =
    pip wheel -w {envtmpdir}/build --no-deps .
    twine check {envtmpdir}/build/*


[testenv:docs]
basepython = python3.8
extras = docs
commands = mkdocs build --clean --strict


[testenv:update-rtd-versions]
deps = urllib3
extras =
skip_install = true
passenv = RTD_TOKEN
commands = python docs/update-rtd-versions.py doc2dash


[testenv:coverage-report]
basepython = python3.10
skip_install = true
deps = coverage[toml]
commands =
    coverage combine
    coverage report
